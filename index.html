<!DOCTYPE html>
<html>
  <head>
    <title>Calcolo Velocità GPS</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
      }
      h1 {
        color: #333;
        margin-top: 20px;
      }
      #status {
        font-size: 18px;
        color: #555;
        margin: 10px 0;
      }
      #speed {
        font-size: 80px;
        font-weight: bold;
        color: #ff5722;
        margin: 20px 0;
        background-color: #ffffff;
        display: inline-block;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }
      button {
        font-size: 18px;
        padding: 10px 20px;
        margin: 20px;
        border: none;
        border-radius: 5px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        display: inline-block;
      }
      button:hover {
        background-color: #0056b3;
      }
      .input-container {
        margin: 20px;
      }
      input[type="text"] {
        font-size: 18px;
        padding: 10px;
        width: 150px;
        border: 2px solid #ccc;
        border-radius: 5px;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Velocità in tempo reale</h1>
    <p id="status">Attivazione GPS...</p>
    <p id="type"></p>
    <p id="speed">Velocità: 0 km/h</p>
    <div class="input-container">
      <input
        type="text"
        id="manualSpeedInput"
        placeholder="Imposta velocità (km/h)" />
      <button id="setSpeedButton">Imposta</button>
    </div>
    <button id="enableSoundButton">Abilita Suono</button>
    <script>
      let isPlaying = false;
      let soundEnabled = false;

      // Crea un oggetto Audio per il suono
      const alertSound = new Audio("alert.mp3");

      // Funzione per abilitare il suono
      document
        .getElementById("enableSoundButton")
        .addEventListener("click", () => {
          alertSound
            .play()
            .then(() => {
              alertSound.pause();
              alertSound.currentTime = 0;
              soundEnabled = true;
              document.getElementById("enableSoundButton").style.display =
                "none";
            })
            .catch((error) => {
              alert(
                "Errore durante l'abilitazione del suono: " + error.message
              );
            });
        });

      function playAlertSound() {
        if (soundEnabled && !isPlaying) {
          alertSound.loop = true;
          alertSound.play();
          isPlaying = true;
        }
      }

      function stopAlertSound() {
        if (isPlaying) {
          alertSound.pause();
          alertSound.currentTime = 0;
          isPlaying = false;
        }
      }

      // Funzione per impostare manualmente la velocità
      document
        .getElementById("setSpeedButton")
        .addEventListener("click", () => {
          const manualSpeedInput = document.getElementById("manualSpeedInput");
          const manualSpeed = parseFloat(manualSpeedInput.value);

          if (!isNaN(manualSpeed) && manualSpeed >= 0) {
            document.getElementById(
              "speed"
            ).innerText = `Velocità: ${manualSpeed.toFixed(2)} km/h`;
            document.getElementById("type").innerText =
              "Velocità impostata manualmente";

            // Attiva o ferma il suono in base alla velocità
            if (manualSpeed > 0) {
              playAlertSound();
            } else {
              stopAlertSound();
            }
          } else {
            alert("Inserisci un valore numerico valido!");
          }
        });

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (position) => {
            document.getElementById("status").innerText =
              "GPS attivato con successo";
          },
          (error) => {
            document.getElementById(
              "status"
            ).innerText = `Errore: ${error.message}`;
          },
          {
            enableHighAccuracy: true,
            maximumAge: 0,
          }
        );
      } else {
        document.getElementById("status").innerText =
          "Geolocalizzazione non supportata dal browser.";
      }
    </script>
  </body>
</html>
